define ("enrol_poodllprovider/mform",["jquery","core/modal_factory","core/modal_events","core/ajax","core/notification","core/yui","core/event","core/str","core/fragment"],function(a,b,c,d,e,f,g,h,i){var j=function(a){this.data=a;this.init()};j.prototype.modal=null;j.prototype.data={};j.prototype.init=function(){var a=[{key:"pluginname",component:this.data.module}];h.get_strings(a).then(function(a){return b.create({type:b.types.SAVE_CANCEL,title:a[0],body:""},this.data.triggerElement)}.bind(this)).then(function(a){this.modal=a;this.modal.setBody(this.getBody(this.data.contextid,this.data.module,this.data.cmid,this.data.formdata));this.modal.setLarge();this.modal.getRoot().on(c.hidden,function(){this.modal.destroy();this.resetDirtyFormState()}.bind(this));this.modal.getRoot().on(c.shown,function(){this.modal.getRoot().append("<style>[data-fieldtype=submit] { display: none ! important; }</style>")}.bind(this));this.modal.getRoot().on(c.save,this.submitForm.bind(this));this.modal.getRoot().on("submit","form",this.submitFormAjax.bind(this));this.modal.show();return this.modal}.bind(this)).fail(e.exception)};j.prototype.getBody=function(a,b,c,d){if("undefined"==typeof d){d={}}var e={ltimodulename:b,cmid:c,jsonformdata:JSON.stringify(d)};return i.loadFragment("enrol_poodllprovider","ltimodule_form",a,e)};j.prototype.onSubmitSuccess=function(a){return a};j.prototype.onValidationError=function(){};j.prototype.onSubmitError=function(a){e.exception(a)};j.prototype.resetDirtyFormState=function(){f.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()})};j.prototype.validateElements=function(){g.notifyFormSubmitAjax(this.modal.getRoot().find("form")[0]);var b=a.merge(this.modal.getRoot().find("[aria-invalid=\"true\"]"),this.modal.getRoot().find(".error"));if(b.length){b.first().focus();return!1}return!0};j.prototype.disableButtons=function(){this.modal.getFooter().find("[data-action]").attr("disabled",!0)};j.prototype.enableButtons=function(){this.modal.getFooter().find("[data-action]").removeAttr("disabled")};j.prototype.submitFormAjax=function(b){b.preventDefault();if(!this.validateElements()){return}this.disableButtons();var c=document.createEvent("HTMLEvents");c.initEvent("change",!0,!0);this.modal.getRoot().find(":input").each(function(a,b){b.dispatchEvent(c)});var e=this.modal.getRoot().find("form").serialize();d.call([{methodname:"enrol_poodllprovider_manage_course_module",args:{contextid:this.data.contextid,itemnumber:this.data.itemnumber,cmid:this.data.cmid,jsonformdata:JSON.stringify(e)},done:this.handleFormSubmissionResponse.bind(this,e),fail:this.handleFormSubmissionFailure.bind(this,e)}])[0].then(function(b){if(""!==b){a("section.activity-list.sections.collapse.show .enrol_poodllprovider_activityitems").prepend(b)}})};j.prototype.handleFormSubmissionResponse=function(){this.modal.hide();this.resetDirtyFormState()};j.prototype.handleFormSubmissionFailure=function(a){this.modal.setBody(this.getBody(a))};j.prototype.submitForm=function(a){a.preventDefault();this.modal.getRoot().find("form").submit()};return j});
//# sourceMappingURL=mform.min.js.map
