{"version":3,"sources":["../src/provider.js"],"names":["define","$","jqui","Str","Ajax","Templates","CustomEvents","Notification","ModalFactory","ModalEvents","Y","MForm","SELECTORS","MENU_COLLAPSE","RETURN_MAIN_MENU","ACTIVITY_SELECT","ACTIVITY_EDIT","ACTIVITY_DELETE","ACTIVITY_ADD","showModalForm","triggerElement","contextid","itemnumber","module","cmid","modal","registerEventListeners","root","events","activate","on","e","data","originalEvent","preventDefault","collapse","hide","show","currentTarget","create","type","types","SAVE_CANCEL","title","body","then","setSaveButtonText","getRoot","save","call","methodname","args","cmids","document","getElementById","submit","init","attr"],"mappings":"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","sourcesContent":["/**\n * LTI Provider.\n *\n * @module     enrol_poodllprovider/institution\n * @class      LTI Provider\n * @package    enrol_poodllprovider\n * @copyright  2020 Michael Gardener <mgardener@cissq.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'jqueryui',\n    'core/str',\n    'core/ajax',\n    'core/templates',\n    'core/custom_interaction_events',\n    'core/notification',\n    'core/modal_factory',\n    'core/modal_events',\n    'core/yui',\n    'enrol_poodllprovider/mform'\n], function($, jqui, Str, Ajax, Templates, CustomEvents, Notification, ModalFactory, ModalEvents, Y, MForm) {\n    var SELECTORS = {\n        MENU_COLLAPSE: '[data-action=\"collapse\"]',\n        RETURN_MAIN_MENU: '[data-action=\"main-menu\"]',\n        ACTIVITY_SELECT: '[data-action=\"activity-select\"]',\n        ACTIVITY_EDIT: '[data-action=\"activity-edit\"]',\n        ACTIVITY_DELETE: '[data-action=\"activity-delete\"]',\n        ACTIVITY_ADD: '[data-action=activity-add]',\n    };\n\n    /**\n     * Modal.\n     *\n     * @param {jQuery} triggerElement\n     * @param {Number} contextid\n     * @param {Number} itemnumber\n     * @param {String} module\n     * @param {String} title\n     * @return {MForm} modal\n     */\n    var showModalForm = function(triggerElement, contextid, itemnumber, module, cmid) {\n        var modal = new MForm({\n            contextid: contextid,\n            itemnumber: itemnumber,\n            module: module,\n            cmid: cmid,\n            triggerElement: triggerElement,\n        });\n        return modal;\n    };\n\n    /**\n     * Listen to and handle events for menu actions.\n     *\n     * @param {Object} root Aside container element.\n     */\n    var registerEventListeners = function(root) {\n        CustomEvents.define(root, [\n            CustomEvents.events.activate\n        ]);\n\n        root.on(CustomEvents.events.activate, SELECTORS.MENU_COLLAPSE, function(e, data) {\n            data.originalEvent.preventDefault();\n            var module = $(this).data('module');\n            $('#collapse-' + module).collapse('toggle');\n            $('#top-menu').hide();\n        });\n\n        root.on(CustomEvents.events.activate, SELECTORS.RETURN_MAIN_MENU, function(e, data) {\n            data.originalEvent.preventDefault();\n            var module = $(this).data('module');\n            $('#collapse-' + module).collapse('toggle');\n            $('#top-menu').show();\n        });\n\n        root.on(CustomEvents.events.activate, SELECTORS.ACTIVITY_EDIT, function(e, data) {\n            data.originalEvent.preventDefault();\n            var module = $(this).data('module');\n            var contextid = $(this).data('contextid');\n            var itemnumber = $(this).data('itemnumber');\n            var cmid = $(this).data('cmid');\n\n            var triggerElement = $(e.currentTarget);\n            showModalForm(triggerElement, contextid, itemnumber, module, cmid);\n        });\n\n        root.on(CustomEvents.events.activate, SELECTORS.ACTIVITY_DELETE, function(e, data) {\n            data.originalEvent.preventDefault();\n            //var module = $(this).data('module');\n            //var contextid = $(this).data('contextid');\n            //var itemnumber = $(this).data('itemnumber');\n            var cmid = $(this).data('cmid');\n\n            ModalFactory.create({\n                type: ModalFactory.types.SAVE_CANCEL,\n                title: 'Delete',\n                body: 'Do you really want to delete?',\n            })\n            .then(function(modal) {\n                modal.setSaveButtonText('Delete');\n                var root = modal.getRoot();\n                root.on(ModalEvents.save, function() {\n                    Ajax.call([{\n                        methodname: 'enrol_poodllprovider_delete_modules',\n                        args: {\n                            cmids: [cmid]\n                        }\n                    }]);\n                });\n                modal.show();\n            });\n        });\n\n        root.on(CustomEvents.events.activate, SELECTORS.ACTIVITY_SELECT, function(e, data) {\n            data.originalEvent.preventDefault();\n            var itemnumber = $(this).data('itemnumber');\n            document.getElementById('poodllprovider_item_' + itemnumber).submit();\n        });\n\n        root.on(CustomEvents.events.activate, SELECTORS.ACTIVITY_ADD, function(e, data) {\n            data.originalEvent.preventDefault();\n            var module = $(this).data('module');\n            var contextid = $(this).data('contextid');\n            var itemnumber = $(this).data('itemnumber');\n\n            var triggerElement = $(e.currentTarget);\n            showModalForm(triggerElement, contextid, itemnumber, module, 0);\n        });\n    };\n\n    /**\n     * Initialise all of the modules for the overview block.\n     *\n     * @param {object} root The root element for the overview block.\n     */\n    var init = function(root) {\n        root = $(root);\n\n        if (!root.attr('data-init')) {\n            registerEventListeners(root);\n            root.attr('data-init', true);\n        }\n    };\n\n    return {\n        init: init\n    };\n});"],"file":"provider.min.js"}