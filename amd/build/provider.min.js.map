{"version":3,"sources":["../src/provider.js"],"names":["define","$","jqui","Str","Ajax","Templates","CustomEvents","Notification","ModalFactory","ModalEvents","Y","MForm","SELECTORS","MENU_COLLAPSE","RETURN_MAIN_MENU","ACTIVITY_SELECT","ACTIVITY_EDIT","ACTIVITY_DELETE","ACTIVITY_ADD","showModalForm","triggerElement","contextid","itemnumber","module","cmid","modal","registerEventListeners","root","events","activate","on","e","data","originalEvent","preventDefault","collapse","hide","show","currentTarget","get_strings","key","component","then","str","create","type","types","SAVE_CANCEL","title","body","setSaveButtonText","getRoot","save","call","methodname","args","cmids","remove","document","getElementById","submit","init","attr"],"mappings":"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","sourcesContent":["/**\n * LTI Provider.\n *\n * @module     enrol_poodllprovider/institution\n * @class      LTI Provider\n * @package    enrol_poodllprovider\n * @copyright  2020 Michael Gardener <mgardener@cissq.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'jqueryui',\n    'core/str',\n    'core/ajax',\n    'core/templates',\n    'core/custom_interaction_events',\n    'core/notification',\n    'core/modal_factory',\n    'core/modal_events',\n    'core/yui',\n    'enrol_poodllprovider/mform'\n], function($, jqui, Str, Ajax, Templates, CustomEvents, Notification, ModalFactory, ModalEvents, Y, MForm) {\n    var SELECTORS = {\n        MENU_COLLAPSE: '[data-action=\"collapse\"]',\n        RETURN_MAIN_MENU: '[data-action=\"main-menu\"]',\n        ACTIVITY_SELECT: '[data-action=\"activity-select\"]',\n        ACTIVITY_EDIT: '[data-action=\"activity-edit\"]',\n        ACTIVITY_DELETE: '[data-action=\"activity-delete\"]',\n        ACTIVITY_ADD: '[data-action=activity-add]',\n    };\n\n    /**\n     * Modal.\n     *\n     * @param {jQuery} triggerElement\n     * @param {Number} contextid\n     * @param {Number} itemnumber\n     * @param {String} module\n     * @param {String} title\n     * @return {MForm} modal\n     */\n    var showModalForm = function(triggerElement, contextid, itemnumber, module, cmid) {\n        var modal = new MForm({\n            contextid: contextid,\n            itemnumber: itemnumber,\n            module: module,\n            cmid: cmid,\n            triggerElement: triggerElement,\n        });\n        return modal;\n    };\n\n    /**\n     * Listen to and handle events for menu actions.\n     *\n     * @param {Object} root Aside container element.\n     */\n    var registerEventListeners = function(root) {\n        CustomEvents.define(root, [\n            CustomEvents.events.activate\n        ]);\n\n        root.on(CustomEvents.events.activate, SELECTORS.MENU_COLLAPSE, function(e, data) {\n            data.originalEvent.preventDefault();\n            var module = $(this).data('module');\n            $('#collapse-' + module).collapse('toggle');\n            $('#top-menu').hide();\n        });\n\n        root.on(CustomEvents.events.activate, SELECTORS.RETURN_MAIN_MENU, function(e, data) {\n            data.originalEvent.preventDefault();\n            var module = $(this).data('module');\n            $('#collapse-' + module).collapse('toggle');\n            $('#top-menu').show();\n        });\n\n        root.on(CustomEvents.events.activate, SELECTORS.ACTIVITY_EDIT, function(e, data) {\n            data.originalEvent.preventDefault();\n            var module = $(this).data('module');\n            var contextid = $(this).data('contextid');\n            var itemnumber = $(this).data('itemnumber');\n            var cmid = $(this).data('cmid');\n\n            var triggerElement = $(e.currentTarget);\n            showModalForm(triggerElement, contextid, itemnumber, module, cmid);\n        });\n\n        root.on(CustomEvents.events.activate, SELECTORS.ACTIVITY_DELETE, function(e, data) {\n            data.originalEvent.preventDefault();\n            var cmid = $(this).data('cmid');\n            var itemnumber = $(this).data('itemnumber');\n\n            Str.get_strings([\n                {key: 'delete', component: 'enrol_poodllprovider'},\n                {key: 'deleteconfirm', component: 'enrol_poodllprovider'},\n            ]).then(function(str) {\n                ModalFactory.create({\n                    type: ModalFactory.types.SAVE_CANCEL,\n                    title: str[0],\n                    body: str[1],\n                })\n                .then(function(modal) {\n                    modal.setSaveButtonText(str[0]);\n                    var root = modal.getRoot();\n                    root.on(ModalEvents.save, function() {\n                        Ajax.call([{\n                            methodname: 'enrol_poodllprovider_delete_modules',\n                            args: {\n                                cmids: [cmid]\n                            }\n                        }])[0]\n                            .then(function() {\n                                $(\"div[data-toolid='\" + itemnumber + \"']\").remove();\n                            });\n                    });\n                    modal.show();\n                });\n            });\n        });\n\n        root.on(CustomEvents.events.activate, SELECTORS.ACTIVITY_SELECT, function(e, data) {\n            data.originalEvent.preventDefault();\n            var itemnumber = $(this).data('itemnumber');\n            document.getElementById('poodllprovider_item_' + itemnumber).submit();\n        });\n\n        root.on(CustomEvents.events.activate, SELECTORS.ACTIVITY_ADD, function(e, data) {\n            data.originalEvent.preventDefault();\n            var module = $(this).data('module');\n            var contextid = $(this).data('contextid');\n            var itemnumber = $(this).data('itemnumber');\n\n            var triggerElement = $(e.currentTarget);\n            showModalForm(triggerElement, contextid, itemnumber, module, 0);\n        });\n    };\n\n    /**\n     * Initialise all of the modules for the overview block.\n     *\n     * @param {object} root The root element for the overview block.\n     */\n    var init = function(root) {\n        root = $(root);\n\n        if (!root.attr('data-init')) {\n            registerEventListeners(root);\n            root.attr('data-init', true);\n        }\n    };\n\n    return {\n        init: init\n    };\n});"],"file":"provider.min.js"}